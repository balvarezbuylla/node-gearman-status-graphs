<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://ogp.me/ns/fb#">
<head>
<title>Sezion - Gearman Job Server Status</title>
</head>
<body> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://code.highcharts.com/highcharts.js"></script> 


  <h1 style='text-align:center;'> Gearman Job Server Status </h1>

  
  <div id="container">
  <% if (error==1){ 
     for (var i=0; i< number_workers; i++) {%>
      <div id="container_<%=i%>"> </div>
   <% }
   }else {%>
      <h1><%=error%></h1>
  <% }%>
  </div>
  



<script>

<% if (error==1){ %>


var hist_wait=<%-history_data_wait%>;
var hist_running=<%-history_data_running%>;
var hist_capable=<%-history_data_capable%>;
var number_workers=<%=number_workers%>;
var names= <%-names%>;
var number_dates=<%=number_dates%>;


$(function () { 

var data_wait=[];
var data_running=[];
var data_capable=[];


  for (var i=0; i<number_workers; i++){    //para cada worker
      var wait=[];
      var running=[];
      var capable=[];
    //para cada worker me quedo con los datos adecuados, que seran tantos como lo que mida el array entre el numero de workers que hay
    for (var j=0; j<number_dates; j++){       
      wait.push(hist_wait[i+j*number_workers]);  
      running.push(hist_running[i+j*number_workers]); 
      capable.push(hist_capable[i+j*number_workers]);    
    }

    //almaceno para cada worker, los datos correspondientes
    data_wait.push(wait);
    data_running.push(running);
    data_capable.push(capable); 

    //para cada worker, tengo una grafica con los datos correspondientes
        $('#container_'+i+'').highcharts({
            title: {
                text: 'Work:'+ names[i]
            },
            xAxis: {
                categories: <%-dates%>, 
                  labels: {
                    rotation: 90
                  }
            },
            series: [{ 
                data: data_wait[i],
                step: 'right',                      
                name: 'Number of jobs in the queue'
                },
                {
                data: data_running[i] ,
                step: 'center',                      
                name: 'Number of running jobs'
                },
                {
                data: data_capable[i],
                step: 'left',                      
                name: 'Number of capable workers'
                }
            ]
        });
      
    }
});

<%}%>

</script>

</body>
</html>